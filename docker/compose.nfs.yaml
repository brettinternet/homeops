---
x-options: &options
  profiles: [nfs]
  networks: [default]
  environment: &environment
    TZ: "${TIMEZONE}"
  deploy:
    restart_policy: &restart_policy
      condition: unless-stopped

services:
  nfs-media:
    <<: *options
    image: itsthenetwork/nfs-server-alpine:latest
    cap_add: [SYS_ADMIN, SETPCAP]
    environment:
      <<: *environment
      SHARED_DIRECTORY: /shared
      PERMITTED: "${PLEX_HOST_IP}"
    ports:
      - 2049:2049
      - 2049:2049/udp
    volumes:
      - "${MEDIA_DIR}:/shared"
    deploy:
      restart_policy: *restart_policy
      placement:
        constraints:
          - node.hostname == "${MEDIA_HOSTNAME}"
