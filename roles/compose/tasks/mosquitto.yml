---
# https://github.com/eclipse/mosquitto
# Note! I had to add `listener 1883 0.0.0.0` to the config in order
# for messages to reach the host from outside the docker network

- name: mosquitto MQTT broker
  containers.podman.podman_container:
    name: mosquitto
    # https://hub.docker.com/_/eclipse-mosquitto
    image: docker.io/library/eclipse-mosquitto
    state: "{{ container_state }}"
    recreate: "{{ container_recreate }}"
    generate_systemd: "{{ container_generate_systemd }}"
    volumes:
      - "{{ appdata_dir }}/mosquitto/mosquitto.conf:/mosquitto/config/mosquitto.conf"
      - "{{ appdata_dir }}/mosquitto/data:/mosquitto/data"
      - "{{ appdata_dir }}/mosquitto/log:/mosquitto/log"
    ports:
      - 1883:1883
      - 9001:9001
    label:
      io.containers.autoupdate: registry
