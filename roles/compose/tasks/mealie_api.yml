---
# https://nightly.mealie.io/documentation/getting-started/installation/installation-checklist/
# Why not separate container for both client and server instead of serving client from python app?
# https://github.com/hay-kot/mealie/discussions/1073#discussioncomment-2991082

- name: Mealie API
  containers.podman.podman_container:
    name: mealie_api
    # https://hub.docker.com/r/hkotel/mealie
    image: docker.io/hkotel/mealie:api-v1.0.0beta-3
    state: "{{ container_state }}"
    recreate: "{{ container_recreate }}"
    generate_systemd: "{{ container_generate_systemd }}"
    env:
      PUID: "{{ puid }}"
      PGID: "{{ pgid }}"
      TZ: "{{ tz }}"
      TOKEN_TIME: 720 # 24 hours * 30 days
      BASE_URL: "https://recipes.{{ root_domain }}"
      AUTO_BACKUP_ENABLED: true
      ALLOW_SIGNUP: false
      SMTP_HOST: "{{ smtp_host }}"
      SMTP_PORT: "{{ smtp_port }}"
      SMTP_FROM_NAME: Recipes
      SMTP_FROM_EMAIL: "{{ smtp_email_from }}"
      SMTP_USER: "{{ smtp_user }}"
      SMTP_PASSWORD: "{{ smtp_password }}"
    volumes:
      - "{{ appdata_dir }}/mealie:/app/data"
    ports:
      - 3013:9000
    label:
      io.containers.autoupdate: registry
