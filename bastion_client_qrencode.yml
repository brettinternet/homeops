---
# TODO: create a third client then proceed below

- name: Print mobile client QR code
  hosts: bastion
  vars:
    encode_file_path: /etc/wireguard/wg0.conf
  tasks:
    - name: Install qrencode
      ansible.builtin.package:
        name: qrencode
        state: present

    - name: "Check if {{ encode_file_path }} exists"
      stat:
        path: "{{ encode_file_path }}"
      register: encode_file_result

    - name: "{{ encode_file_path }} must exist"
      fail:
        msg: "{{ encode_file_path }} does not exist"
      when: not encode_file_result.stat.exists

    # Source: https://wiki.debian.org/Wireguard#A3._Import_by_reading_a_QR_code_.28most_secure_method.29
    - name: Print QR encoded file
      command: "qrencode -t ansiutf8 < {{ encode_file_path }}"
