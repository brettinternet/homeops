---
- name: Setup docker compose services
  hosts: server
  vars_files:
    - "{{ playbook_dir }}/vars/secret.yml"
  vars:
    containers:
      - plex
      - nzbget
      - sonarr
      - radarr
      - espial
      - miniflux # need to add miniflux_db to this for podman_systemd
      - ombi
      - tautulli
      - healthchecks
      # - syncthing
      - oauth
      - traefik
  roles:
    - role: traefik
      when: "'traefik' in containers"
    - role: compose
      vars:
        # absent - A container matching the specified name will be stopped and removed.
        # present - Asserts the existence of a container matching the name and any provided configuration parameters. If no container matches the name, a container will be created. If a container matches the name but the provided configuration does not match, the container will be updated, if it can be. If it cannot be updated, it will be removed and re-created with the requested config. Image version will be taken into account when comparing configuration. Use the recreate option to force the re-creation of the matching container.
        # started - Asserts there is a running container matching the name and any provided configuration. If no container matches the name, a container will be created and started. Use recreate to always re-create a matching container, even if it is running. Use force_restart to force a matching container to be stopped and restarted.
        # stopped - Asserts that the container is first present, and then if the container is running moves it to a stopped state.
        # created - (new feature) just created the image since our podman_systemd role will start the image with systemd
        state: created
        # recreate: true
    - role: podman_systemd
      # vars:
      #   podman_systemd_action: remove
