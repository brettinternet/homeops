---
version: "3"

services:
  plex:
    image: plexinc/pms-docker
    container_name: plex
    restart: unless-stopped
    environment:
      - TZ=${TZ}
      - PLEX_CLAIM=${PLEX_CLAIM_CODE}
    volumes:
      - ${APPDATA_DIR}/plex:/config
      - ${SOTRAGE_DIR}/music:/data/Music
      - ${SOTRAGE_DIR}/movies:/data/Movies
      - ${SOTRAGE_DIR}/tv:/data/TV
      - ${SOTRAGE_DIR}/temp/transcode:/transcode
    ports:
      # Plex ports - source: https://www.techjunkie.com/what-port-does-plex-media-server-use-to-stream/
      - "32400:32400" # Plex Media Server
      - "3005:3005" # Plex Companion
      - "8324:8324" # Roku via Plex Companion
      - "32469:32649" # Plex DLNA Server
      - "1900:1900/udp" # Plex DLNA Server
      - "32410:32410/udp" # network discovery
      - "32412:32412/udp" # network discovery
      - "32413:32413/udp" # network discovery

  # https://github.com/linuxserver/docker-ombi
  ombi:
    # https://hub.docker.com/r/linuxserver/ombi
    image: linuxserver/ombi
    container_name: ombi
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
    volumes:
      - ${APPDATA_DIR}/ombi/config:/config
    ports:
      - 3579:3579

  # https://github.com/linuxserver/docker-nzbget
  nzbget:
    # https://hub.docker.com/r/linuxserver/nzbget
    image: linuxserver/nzbget
    container_name: nzbget
    restart: unless-stopped
    environment:
      - TZ=${TZ}
    volumes:
      - ${APPDATA_DIR}/nzbget:/config
      - ${STORAGE_DIR}/downloads:/downloads
    ports:
      - 6789:6789

  # https://github.com/linuxserver/docker-sonarr
  sonarr:
    # https://hub.docker.com/r/linuxserver/sonarr
    image: linuxserver/sonarr
    container_name: sonarr
    restart: unless-stopped
    environment:
      - PGID=1000
      - PUID=1000
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${APPDATA_DIR}/sonarr:/config
      - ${STORAGE_DIR}/tv:/tv
      - ${STORAGE_DIR}/downloads/complete/tv:/downloads
    ports:
      - 8989:8989

  # https://github.com/linuxserver/docker-radarr
  radarr:
    # https://hub.docker.com/r/linuxserver/radarr
    image: linuxserver/radarr
    container_name: radarr
    restart: unless-stopped
    environment:
      - PGID=1000
      - PUID=1000
      - TZ=${TZ}
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${APPDATA_DIR}/radarr:/config
      - ${STORAGE_DIR}/movies:/movies
      - ${STORAGE_DIR}/downloads/complete/movies:/downloads
    ports:
      - 7878:7878

  code-server:
    image: linuxserver/code-server
    container_name: code-server
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
      - PASSWORD=${CODE_SERVER_PASSWORD} # optional
      - SUDO_PASSWORD=${CODE_SERVER_SUDO_PASSWORD} # optional
    volumes:
      - ${APPDATA_DIR}/code_server:/config
    ports:
      - 8443:8443

  portainer:
    image: portainer/portainer
    container_name: portainer
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${APPDATA_DIR}/portainer:/data

  # https://github.com/containrrr/watchtower
  watchtower:
    # https://hub.docker.com/r/containrrr/watchtower
    image: containrrr/watchtower
    container_name: watchtower
    # TODO: add notifications - https://containrrr.github.io/watchtower/notifications/
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${APPDATA_DIR}/watchtower/config.json:/config.json
    command: --interval 900 #15 minutes

  # https://github.com/linuxserver/docker-unifi-controller
  unifi:
    # https://hub.docker.com/r/linuxserver/unifi-controller
    image: linuxserver/unifi-controller
    container_name: unifi-controller
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
      # - MEM_LIMIT=1024M #optional
    volumes:
      - ${APPDATA_DIR}/unifi:/config
    ports:
      - 3478:3478/udp # Unifi communication port
      - 10001:10001/udp # AP discovery
      - 8080:8080 # Unifi communication port
      - 8081:8081 # Unifi communication port
      - 8443:8443 # UI
      - 8843:8843 # Unifi communication port
      - 8880:8880 # Unifi communication port
      - 6789:6789 # For throughput test
